# 浏览器渲染过程

**解析HTML生成DOM树**

**解析CSS生成CSS树**

**合并DOM树和CSS树生成渲染树(render树)**

**计算每个节点在页面的位置**

**将每个节点绘制到屏幕上**

**构建DOM树**

字节数据->字符串->token->node->dom

a)浏览器将获得的html字节数据根据编码(UTF-8)将它转化成在字符串

b)将这些字符串按照html规范标准转换成不同的标记token，每个token有自己的独特的含义以及规则集。

c)将token转换为节点对象，这些对象分别定义了他们的属性和规则

d)遍历这些对象，构建DOM

**构建CSS规则树**

和DOM树类似

**构建渲染树**

一般来说，渲染树和DOM树是一一对应的，但一些不可见的DOM元素不会插入到渲染树中，比如`<head>`，display为none的元素。浏览器会先从DOM树的根节点开始遍历每个可见节点，然后对每个节点找到适配的CSS样式规则并应用。

**布局**

渲染树生成后，还不能渲染到屏幕上，渲染到屏幕上需要得到每个节点的位置信息。由于每个节点都是一个对象，包含宽高、位置、背景色等信息，所以浏览器可以通过这些样式信息来确定每个节点对象在页面上确切位置。一般回流会发生在这里

**绘制**

一般重绘会发生在这里



**浏览器在渲染过程中遇到JS文件如何处理？**

JS可以操作DOM来修改DOM结构，可以操作CSSOM来修改节点样式，所以渲染过程遇到`<script>`标签时，DOM构建将暂停，直至脚本完成执行，然后在构建DOM。如果JS还操作了CSS，如果这个CSSOM树没有构建完成的话，JS需要等待CSSOM下载并解析完才可以操作CSSOM。所以一般将JS放在文档底部，或者使用defer,async。

defer不阻塞DOM构建，执行会在DOM构建后，aysnc不阻塞DOM构建，解析完会立即执行



**css阻塞渲染？**

必须CSSOM完全生成后才开始渲染

优化：把CSS放在head 尽量使用id,class不要过渡嵌套

























