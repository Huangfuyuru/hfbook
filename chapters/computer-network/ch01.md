## http/2.0

http/1.0 缺点

1. http/1.0一条连接上只能发送一个请求。http/1.1解决部分并发请求
2. 请求只能从客户端开始。
3. 请求/响应首部没有压缩。并且每次发送的首部中有很多相同的内容
4. 可任意选择数据压缩格式。非强制压缩



http 2.0 改进

1. 多路复用：通过单一的 TCP 连接，可以无限制处理多个 HTTP 请求。所有请求的处理都在一条 TCP 连接上完成。
2. 压缩 HTTP 首部：压缩 HTTP 请求和响应首部
3. 客户端拉曳 服务器推送：服务器端可以主动提示客户端请求所需的资源。服务器主动向客户端推送数据的功能。
4. 对请求划分优先级
5. WebSocket 



WebSocket

WebSocket Web浏览器与Web服务器之间全双工通信标准。当Web服务器与客户端之间建立起 WebSocket 协议的通信连接，之后所有的通信都依靠这个专用协议进行。通信过程中可互相发送JSON、XML、HTML或图片等任意格式的数据。ws:// wss://

为了实现 WebSocket,在HTTP连接建立之后，需要完成一次"握手"。

需要用到 HTTP 的 首部字段

Upgrade 首部字段告知服务器通信协议发生改变,以达到握手的目的。

Sec-WebSocket-Key 字段 内记录着握手 过程中必不可少的键值

Sec-WebSocket-Protocol 记录使用的子协议

```
GET /chat HTTP/1.1
Host: server.example.com
Origin: http://example.com //浏览器
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGHI.....
Sec-WebSocket-Protocol: chat,superchat
Sec-WebSocket-Version: 13
```



WebSocket 的简单实例

```
var ws = new WebSocket("wss://echo.websocket.org");

ws.onopen = function(evt) {
	console.log('Connection open ...');
	ws.send('Hello WebSockets')
}

ws.onmessage = function(evt) {
	console.log('Received  Message:'+evt.data);
	ws.close()
}

ws.onclose = function(evt) {
	console.log("connection closed")
}
```

1. WebSocket 对象是一个构造函数，用于新建 WebSocket 实例

   `var ws = new WebSocket('ws://localhost:8080')`

   执行上面语句 后，客户端就会与服务器连接

2. 事件

   open 当一个 WebSocket 连接成功时触发

   close  当一个 WebSocket 连接关闭时触发

   message  当通过 WebSocket 收到数据时触发

   error  当一个 WebSocket 连接因错误而关闭时触发，例如无法发送数据时

3. 方法

   send 用于向服务器发送数据

   `ws.send('your message')`

   

http 在安全方面的缺点：

1. 通信使用明文，内容可能被监听
2. 不验证对方的身份，因此有可能遭遇伪装
3. 无法验证报文的完整性，所以 有可能已遭篡改。

https 是为了解决上面的问题

​	http  + 加密 + 认证 + 完整性保护 = https

http 并非是应用层的一种新协议，只是 http 通信接口 部分用 SSL 和 TLS 协议代替而已。

通常，HTTP直接和TCP通信。当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信。 